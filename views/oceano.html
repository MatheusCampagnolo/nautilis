<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">Oceano - Nautilis</title>
    <meta
      name="description"
      content="Explore informa√ß√µes detalhadas sobre este oceano, incluindo caracter√≠sticas, vida marinha e curiosidades fascinantes."
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "ocean-deep": "#003366",
              "ocean-blue": "#0066cc",
              "ocean-light": "#e6f3ff",
              "ocean-medium": "#004d99",
            },
          },
        },
      };
    </script>

    <style>
      /* Ajustes para os cards de preview de animal */
      .animal-preview-card {
        min-width: 240px;
        max-width: 320px;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* garante footer sempre abaixo */
        padding: 1rem;
        box-sizing: border-box;
      }

      .animal-preview-card .card-media {
        height: 10rem;
        overflow: hidden;
        border-radius: 0.5rem;
        margin-bottom: 0.6rem;
      }

      .animal-preview-card .card-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .animal-preview-card h4 {
        margin-bottom: 0.25rem;
      }

      .animal-preview-card p {
        margin: 0;
      }

      .animal-footer {
        margin-top: 0.75rem;
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .animal-footer .animal-category-label {
        background: rgba(0, 51, 102, 0.95);
        color: #fff;
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 999px;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.12);
        line-height: 1;
        white-space: nowrap;
      }

      /* difus√£o do line-clamp sem depender de plugin tailwind */
      .line-clamp-3 {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
        overflow: hidden;
      }

      #to-top-btn {
        position: fixed;
        right: 22px;
        bottom: 22px;
        z-index: 60;
        width: 52px;
        height: 52px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #0066cc;
        color: #fff;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        border: none;
        cursor: pointer;
      }

      .anchor-nav a.active {
        text-decoration: underline;
        font-weight: 700;
      }
    </style>
  </head>

  <body class="bg-white">
    <!-- NAV -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
          <a href="/" class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-ocean-blue rounded-full flex items-center justify-center"
            >
              <span class="text-white text-xl">üåä</span>
            </div>
            <h1 class="text-2xl font-bold text-ocean-deep">Nautilis</h1>
          </a>

          <div class="hidden md:flex space-x-8">
            <a
              href="/"
              class="font-medium text-ocean-deep hover:text-ocean-blue transition-colors"
              >In√≠cio</a
            >
            <a
              href="/sobre"
              class="font-medium text-ocean-deep hover:text-ocean-blue transition-colors"
              >Sobre</a
            >
            <a
              href="/quem-somos"
              class="font-medium text-ocean-deep hover:text-ocean-blue transition-colors"
              >Quem Somos</a
            >
            <a
              href="/mapa"
              class="font-medium text-ocean-deep hover:text-ocean-blue transition-colors"
              >Mapa Interativo</a
            >
            <a
              href="/lista-oceanos"
              class="font-medium text-ocean-deep hover:text-ocean-blue transition-colors"
              >Lista de Oceanos</a
            >
          </div>
        </div>
      </div>
    </nav>

    <!-- LOADING -->
    <div id="loading" class="min-h-screen flex items-center justify-center">
      <div class="text-center">
        <div
          class="animate-spin rounded-full h-12 w-12 border-b-2 border-ocean-blue mx-auto"
        ></div>
        <p class="mt-4 text-gray-600">Carregando informa√ß√µes do oceano...</p>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="ocean-content" class="py-20 bg-white min-h-screen hidden">
      <div class="max-w-6xl mx-auto px-4">
        <!-- Voltar -->
        <div class="mb-6">
          <a
            href="/mapa"
            class="inline-flex items-center space-x-2 text-ocean-blue hover:text-ocean-medium transition-colors"
          >
            <span class="text-lg">‚Üê</span><span>Voltar ao mapa</span>
          </a>
        </div>

        <!-- Header -->
        <header class="text-center mb-8">
          <h1
            id="ocean-title"
            class="text-4xl md:text-5xl font-bold text-ocean-deep mb-3"
          ></h1>
          <p
            id="ocean-subtitle"
            class="text-lg text-gray-600 max-w-4xl mx-auto"
          ></p>
        </header>

        <!-- Hero image -->
        <section class="mb-8">
          <img
            id="ocean-hero-image"
            src=""
            alt=""
            class="w-full h-80 md:h-96 object-cover rounded-2xl shadow-2xl"
          />
        </section>

        <!-- Stats -->
        <section id="section-stats" class="mb-6">
          <div id="ocean-stats" class="grid md:grid-cols-4 gap-6">
            <!-- preenchido via JS -->
          </div>
        </section>

        <!-- Top description -->
        <section
          id="section-description"
          class="mb-6 max-w-4xl mx-auto text-center"
        >
          <p
            id="ocean-description"
            class="text-base md:text-lg text-gray-700 leading-relaxed"
          ></p>
        </section>

        <!-- SUM√ÅRIO / ANCORAS (ordenado conforme a p√°gina) -->
        <section id="section-summary" class="mb-8">
          <div
            class="bg-white border border-gray-100 rounded-2xl p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4"
          >
            <div class="text-sm text-gray-600">Sum√°rio:</div>
            <nav id="summary-nav" class="anchor-nav overflow-x-auto w-full">
              <ul
                id="summary-links"
                class="flex gap-3 items-center whitespace-nowrap"
              ></ul>
            </nav>
          </div>
        </section>

        <!-- Countries & Rivers -->
        <section id="countries" class="grid lg:grid-cols-2 gap-10 mb-10">
          <div>
            <h2 class="text-2xl font-bold text-ocean-deep mb-4">
              Pa√≠ses que fazem fronteira
            </h2>
            <ul
              id="ocean-countries"
              class="list-disc list-inside space-y-2 text-gray-700"
            ></ul>
          </div>
          <div id="rivers">
            <h2 class="text-2xl font-bold text-ocean-deep mb-4">
              Rios que desaguam
            </h2>
            <ul
              id="ocean-rivers"
              class="list-disc list-inside space-y-2 text-gray-700"
            ></ul>
          </div>
        </section>

        <!-- Characteristics & Marine life -->
        <section id="characteristics" class="grid lg:grid-cols-2 gap-16 mb-10">
          <div>
            <h2 class="text-2xl font-bold text-ocean-deep mb-4">
              Caracter√≠sticas Principais
            </h2>
            <div
              id="ocean-characteristics"
              class="space-y-4 text-gray-700"
            ></div>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-ocean-deep mb-4">
              Vida Marinha (vis√£o geral)
            </h2>
            <div id="ocean-marine-life" class="space-y-4 text-gray-700"></div>
          </div>
        </section>

        <!-- ANIMAIS: preview √∫nico (1 card por categoria) -->
        <section id="animals" class="mb-12">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Animais (pr√©-visualiza√ß√£o)
          </h2>

          <div class="mb-4">
            <div
              id="animals-preview-track"
              class="flex gap-4 overflow-x-auto pb-3 pl-1"
            >
              <!-- 4 cards ser√£o inseridos aqui: endangered, important, rare, popular -->
            </div>
          </div>

          <div class="text-center">
            <a
              id="animals-see-more"
              href="#"
              class="inline-block bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
            >
              Ver mais
            </a>
          </div>
        </section>

        <!-- Temperatura por esta√ß√£o -->
        <section id="temperature" class="mb-10">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Temperatura por Esta√ß√£o
          </h2>
          <div class="overflow-x-auto">
            <table
              id="ocean-temperature"
              class="w-full text-left border-collapse"
            >
              <thead class="bg-ocean-light">
                <tr>
                  <th class="p-3 border">Esta√ß√£o</th>
                  <th class="p-3 border">Temperatura M√©dia</th>
                </tr>
              </thead>
              <tbody class="text-gray-700"></tbody>
            </table>
          </div>
        </section>

        <!-- Correntes -->
        <section id="currents" class="mb-10">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4">
            Correntes Mar√≠timas
          </h2>
          <ul
            id="ocean-currents"
            class="list-disc list-inside space-y-2 text-gray-700"
          ></ul>
        </section>

        <!-- El Ni√±o / La Ni√±a (s√≥ exibe se tiver dados) -->
        <section id="elnino" class="mb-10 hidden">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4">
            El Ni√±o & La Ni√±a
          </h2>
          <div id="ocean-el-nino" class="text-gray-700 leading-relaxed"></div>
        </section>

        <!-- Curiosidades -->
        <section id="curiosities" class="mb-10">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Curiosidades Fascinantes
          </h2>
          <div id="ocean-fun-facts" class="grid md:grid-cols-2 gap-6"></div>
        </section>

        <!-- Fatos Hist√≥ricos -->
        <section id="history" class="mb-10">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Contexto Hist√≥rico
          </h2>
          <ul
            id="ocean-historical-facts"
            class="list-disc list-inside space-y-2 text-gray-700"
          ></ul>
        </section>

        <!-- Outras Informa√ß√µes -->
        <section id="otherinfo" class="mb-10">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Outras Informa√ß√µes
          </h2>
          <div
            id="ocean-other-info"
            class="prose max-w-none text-gray-700"
          ></div>
        </section>

        <!-- Outras Fontes -->
        <section id="sources" class="mb-16">
          <h2 class="text-2xl font-bold text-ocean-deep mb-4 text-center">
            Outras Fontes
          </h2>
          <ul
            id="ocean-sources"
            class="list-inside space-y-2 text-gray-700"
          ></ul>
        </section>

        <!-- Navega√ß√£o entre oceanos -->
        <div class="text-center mt-8">
          <h3 class="text-2xl font-bold text-ocean-deep mb-6">
            Explore Outros Oceanos
          </h3>
          <div class="flex flex-wrap justify-center gap-4">
            <a
              href="/oceano/pacific"
              class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
              >Pac√≠fico</a
            >
            <a
              href="/oceano/atlantic"
              class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
              >Atl√¢ntico</a
            >
            <a
              href="/oceano/indian"
              class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
              >√çndico</a
            >
            <a
              href="/oceano/arctic"
              class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
              >√Årtico</a
            >
            <a
              href="/oceano/southern"
              class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
              >Austral</a
            >
          </div>
        </div>
      </div>
    </div>

    <!-- ERROR -->
    <div
      id="error-content"
      class="min-h-screen flex items-center justify-center hidden"
    >
      <div class="text-center">
        <span class="text-6xl">üåä</span>
        <h2 class="text-3xl font-bold text-ocean-deep mt-4 mb-2">
          Oceano n√£o encontrado
        </h2>
        <p class="text-gray-600 mb-6">
          O oceano que voc√™ est√° procurando n√£o existe.
        </p>
        <a
          href="/mapa"
          class="bg-ocean-blue hover:bg-ocean-medium text-white px-6 py-3 rounded-full transition-colors"
          >Voltar ao Mapa</a
        >
      </div>
    </div>

    <!-- floating "top" button -->
    <button
      id="to-top-btn"
      title="Ir para o sum√°rio"
      aria-label="Ir para o sum√°rio"
    >
      ‚Üë
    </button>

    <!-- Footer -->
    <footer class="bg-ocean-deep text-white py-16">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid md:grid-cols-4 gap-8">
          <div class="col-span-2">
            <div class="flex items-center space-x-3 mb-6">
              <div
                class="w-12 h-12 bg-ocean-blue rounded-full flex items-center justify-center"
              >
                <span class="text-white text-xl">üåä</span>
              </div>
              <h3 class="text-2xl font-bold">Nautilis</h3>
            </div>
            <p class="text-gray-300 mb-6 max-w-md">
              Explore os oceanos do mundo de forma interativa e educativa.
              Descubra as maravilhas que cobrem nosso planeta azul.
            </p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Explorar</h4>
            <ul class="space-y-2 text-gray-300">
              <li>
                <a href="/mapa" class="hover:text-white transition-colors"
                  >Mapa Interativo</a
                >
              </li>
              <li>
                <a
                  href="/lista-oceanos"
                  class="hover:text-white transition-colors"
                  >Lista de Oceanos</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Recursos</h4>
            <ul class="space-y-2 text-gray-300">
              <li>
                <a href="/sobre" class="hover:text-white transition-colors"
                  >Sobre</a
                >
              </li>
              <li>
                <a href="/quem-somos" class="hover:text-white transition-colors"
                  >Quem somos</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div
          class="border-t border-gray-600 pt-8 mt-12 text-center text-gray-400"
        >
          <p>&copy; 2025 Nautilis. Todos os direitos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
      /* ---------- fallback images ---------- */
      const PLACEHOLDER_ANIMAL =
        "https://placehold.co/400x250/png?text=Imagem+Animal";
      const DEFAULT_HERO =
        "https://placehold.co/1200x600/png?text=Imagem+do+Oceano";

      const oceanImages = {
        pacific:
          "https://images.unsplash.com/photo-1439066615861-d1af74d74000?auto=format&fit=crop&w=1200&q=80",
        atlantic:
          "https://images.unsplash.com/photo-1505142468610-359e7d316be0?auto=format&fit=crop&w=1200&q=80",
        indian:
          "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=1200&q=80",
        arctic:
          "https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=1200&q=80",
        southern:
          "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?auto=format&fit=crop&w=1200&q=80",
      };

      /* ---------- helpers ---------- */
      function getOceanIdFromUrl() {
        const path = window.location.pathname;
        const parts = path.split("/");
        return parts[parts.length - 1] || parts[parts.length - 2];
      }

      function safeArray(v) {
        if (!v) return [];
        if (Array.isArray(v)) return v;
        if (typeof v === "string") return v ? [v] : [];
        return [];
      }

      function createPreviewAnimalCard(animal, categoryLabel) {
        const img =
          animal && (animal.img || animal.image)
            ? animal.img || animal.image
            : PLACEHOLDER_ANIMAL;
        const name = animal && animal.name ? animal.name : "Nome desconhecido";
        const summary =
          animal && animal.summary
            ? animal.summary
            : animal && animal.desc
            ? animal.desc
            : "";
        const wrapper = document.createElement("article");
        wrapper.className =
          "animal-preview-card bg-white rounded-lg overflow-hidden shadow";

        wrapper.innerHTML = `
        <div class="card-media">
          <img src="${img}" alt="${name}">
        </div>
        <div class="pt-2">
          <h4 class="font-semibold text-ocean-deep mb-1">${name}</h4>
          <p class="text-sm text-gray-600 line-clamp-3">${summary}</p>
        </div>
        <div class="animal-footer">
          <span class="animal-category-label">${categoryLabel}</span>
        </div>
      `;
        return wrapper;
      }

      /* ---------- build summary nav dynamically (in page order) ---------- */
      function buildSummaryNav(visibleSections) {
        const container = document.getElementById("summary-links");
        container.innerHTML = "";
        visibleSections.forEach((s) => {
          const li = document.createElement("li");
          li.innerHTML = `<a class="text-sm text-ocean-blue hover:underline" href="#${s.id}">${s.label}</a>`;
          container.appendChild(li);
        });

        // smooth scroll + active state
        container.querySelectorAll("a").forEach((a) => {
          a.addEventListener("click", (e) => {
            e.preventDefault();
            const id = a.getAttribute("href").slice(1);
            const el = document.getElementById(id);
            if (!el) return;
            el.scrollIntoView({ behavior: "smooth", block: "start" });
            container
              .querySelectorAll("a")
              .forEach((x) => x.classList.remove("active"));
            a.classList.add("active");
            history.replaceState(null, "", `#${id}`);
          });
        });

        // IntersectionObserver to update active link while scrolling
        const links = Array.from(container.querySelectorAll("a"));
        const observerOptions = {
          root: null,
          rootMargin: "0px 0px -60% 0px",
          threshold: 0,
        };

        if (window._summaryObserver) window._summaryObserver.disconnect();
        window._summaryObserver = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (!entry.target.id) return;
            const link = links.find(
              (l) => l.getAttribute("href") === `#${entry.target.id}`
            );
            if (!link) return;
            if (entry.isIntersecting) {
              links.forEach((l) => l.classList.remove("active"));
              link.classList.add("active");
            }
          });
        }, observerOptions);

        visibleSections.forEach((s) => {
          const el = document.getElementById(s.id);
          if (el) window._summaryObserver.observe(el);
        });
      }

      /* ---------- main: load and display ocean ---------- */
      let CURRENT_OCEAN = null;

      async function loadOceanData() {
        const oceanId = getOceanIdFromUrl();
        try {
          const response = await fetch(`/api/oceano/${oceanId}`);
          if (!response.ok) throw new Error("Oceano n√£o encontrado");
          const ocean = await response.json();
          CURRENT_OCEAN = ocean;
          displayOceanData(ocean);
        } catch (err) {
          console.error(err);
          showError();
        }
      }

      function displayOceanData(ocean) {
        if (!ocean) return showError();

        // Title & meta
        document.getElementById(
          "page-title"
        ).textContent = `${ocean.name} - Nautilis`;
        document.title = `${ocean.name} - Nautilis`;

        // header
        document.getElementById("ocean-title").textContent = ocean.name || "";
        document.getElementById("ocean-subtitle").textContent =
          ocean.subtitle || "";

        // hero
        const hero = document.getElementById("ocean-hero-image");
        hero.src = ocean.heroImage
          ? ocean.heroImage
          : oceanImages[ocean.id] || DEFAULT_HERO;
        hero.alt = `${ocean.name} - imagem`;

        // stats
        const stats = [];
        if (ocean.area) stats.push({ value: ocean.area, label: "√Årea" });
        if (ocean.maxDepth)
          stats.push({ value: ocean.maxDepth, label: "Profundidade m√°xima" });
        if (ocean.avgTemp)
          stats.push({ value: ocean.avgTemp, label: "Temperatura m√©dia" });
        if (ocean.volume) stats.push({ value: ocean.volume, label: "Volume" });
        const statsContainer = document.getElementById("ocean-stats");
        statsContainer.innerHTML = stats
          .map(
            (s) => `
          <div class="bg-gradient-to-br from-ocean-light to-white p-5 rounded-2xl text-center">
            <div class="text-xl md:text-2xl font-bold text-ocean-deep mb-1">${s.value}</div>
            <div class="text-sm text-ocean-deep/70">${s.label}</div>
          </div>
        `
          )
          .join("");

        // description
        document.getElementById("ocean-description").textContent =
          ocean.description || "";

        // countries & rivers
        const countriesArr = safeArray(ocean.countries);
        const riversArr = safeArray(ocean.rivers);
        document.getElementById("ocean-countries").innerHTML =
          countriesArr.map((c) => `<li>${c}</li>`).join("") || "";
        document.getElementById("ocean-rivers").innerHTML =
          riversArr.map((r) => `<li>${r}</li>`).join("") || "";

        // characteristics & marine life
        const charArr = safeArray(ocean.characteristics);
        const marineArr = safeArray(ocean.marineLife);
        document.getElementById("ocean-characteristics").innerHTML = charArr
          .map((ch) => `<p class="text-gray-700">‚Ä¢ ${ch}</p>`)
          .join("");
        document.getElementById("ocean-marine-life").innerHTML = marineArr
          .map((m) => `<p class="text-gray-700">‚Ä¢ ${m}</p>`)
          .join("");

        // animals preview: one per category (first item) with label
        const animalsObj = ocean.animals || {};
        const endangered = safeArray(animalsObj.endangered);
        const important = safeArray(animalsObj.important);
        const rare = safeArray(animalsObj.rare);
        const popular = safeArray(animalsObj.popular);

        const previewTrack = document.getElementById("animals-preview-track");
        previewTrack.innerHTML = "";

        const addIfExists = (arr, label) => {
          if (arr.length > 0) {
            const first =
              typeof arr[0] === "string" ? { name: arr[0] } : arr[0];
            previewTrack.appendChild(createPreviewAnimalCard(first, label));
          } else {
            // placeholder card to give visual consistency
            previewTrack.appendChild(
              createPreviewAnimalCard(
                { name: "‚Äî", summary: "Nenhum registro." },
                label
              )
            );
          }
        };

        addIfExists(endangered, "Em extin√ß√£o");
        addIfExists(important, "Importante");
        addIfExists(rare, "Pouco conhecido");
        addIfExists(popular, "Mais conhecido");

        // set "ver mais" link to the animals subpage
        const seeMoreBtn = document.getElementById("animals-see-more");
        seeMoreBtn.href = `/oceano/${ocean.id}/animais`;

        // temperature
        const tempTbody = document.querySelector("#ocean-temperature tbody");
        tempTbody.innerHTML = "";
        if (ocean.temperature) {
          if (Array.isArray(ocean.temperature)) {
            ocean.temperature.forEach((t) => {
              const season = t.season || t.name || "‚Äî";
              const value = t.value || t.temp || "‚Äî";
              tempTbody.insertAdjacentHTML(
                "beforeend",
                `<tr><td class="p-3 border">${season}</td><td class="p-3 border">${value}</td></tr>`
              );
            });
          } else if (typeof ocean.temperature === "object") {
            Object.entries(ocean.temperature).forEach(([season, value]) => {
              tempTbody.insertAdjacentHTML(
                "beforeend",
                `<tr><td class="p-3 border">${season}</td><td class="p-3 border">${value}</td></tr>`
              );
            });
          } else {
            tempTbody.innerHTML = `<tr><td class="p-3 border" colspan="2">Informa√ß√£o n√£o dispon√≠vel</td></tr>`;
          }
        } else {
          tempTbody.innerHTML = `<tr><td class="p-3 border" colspan="2">Informa√ß√£o n√£o dispon√≠vel</td></tr>`;
        }

        // currents
        const currentsArr = safeArray(ocean.currents);
        document.getElementById("ocean-currents").innerHTML =
          currentsArr.map((c) => `<li>${c}</li>`).join("") || "";

        // El Ni√±o / La Ni√±a
        const elNinoSection = document.getElementById("elnino");
        const elNinoContainer = document.getElementById("ocean-el-nino");
        if (ocean.elNino || ocean.laNina || ocean.elNinoLaNina) {
          elNinoSection.classList.remove("hidden");
          const parts = [];
          if (ocean.elNino)
            parts.push(`<strong>El Ni√±o:</strong> ${ocean.elNino}`);
          if (ocean.laNina)
            parts.push(`<strong>La Ni√±a:</strong> ${ocean.laNina}`);
          if (ocean.elNinoLaNina) parts.push(`${ocean.elNinoLaNina}`);
          elNinoContainer.innerHTML = parts.join("<br/><br/>");
        } else {
          elNinoSection.classList.add("hidden");
        }

        // curiosities
        const funFactsContainer = document.getElementById("ocean-fun-facts");
        funFactsContainer.innerHTML = "";
        const funFacts = safeArray(ocean.funFacts);
        if (funFacts.length > 0) {
          funFacts.slice(0, 8).forEach((f) => {
            funFactsContainer.insertAdjacentHTML(
              "beforeend",
              `
            <div class="p-6 bg-white rounded-lg shadow">
              <p class="text-gray-700 leading-relaxed">üí° ${f}</p>
            </div>
          `
            );
          });
        }

        // history
        const historyArr = safeArray(ocean.historicalFacts);
        document.getElementById("ocean-historical-facts").innerHTML =
          historyArr.map((h) => `<li>${h}</li>`).join("") || "";

        // other info
        const otherInfoContainer = document.getElementById("ocean-other-info");
        otherInfoContainer.innerHTML = "";
        if (ocean.otherInfo) {
          if (typeof ocean.otherInfo === "string") {
            otherInfoContainer.innerHTML = `<p class="text-gray-700 leading-relaxed">${ocean.otherInfo}</p>`;
          } else if (Array.isArray(ocean.otherInfo)) {
            otherInfoContainer.innerHTML = ocean.otherInfo
              .map(
                (item) =>
                  `<p class="text-gray-700 leading-relaxed">‚Ä¢ ${item}</p>`
              )
              .join("");
          } else {
            otherInfoContainer.innerHTML = `<pre class="whitespace-pre-wrap text-sm text-gray-700">${JSON.stringify(
              ocean.otherInfo,
              null,
              2
            )}</pre>`;
          }
        }

        // sources
        const sourcesList = document.getElementById("ocean-sources");
        sourcesList.innerHTML = "";
        const sources = safeArray(ocean.sources);
        if (sources.length > 0) {
          sources.slice(0, 12).forEach((s) => {
            if (typeof s === "string") {
              const isUrl = /^https?:\/\//i.test(s);
              if (isUrl) {
                sourcesList.insertAdjacentHTML(
                  "beforeend",
                  `<li><a href="${s}" target="_blank" rel="noopener noreferrer" class="text-ocean-blue hover:underline">${s}</a></li>`
                );
              } else {
                sourcesList.insertAdjacentHTML("beforeend", `<li>${s}</li>`);
              }
            } else if (typeof s === "object" && s.url) {
              const title = s.title || s.url;
              sourcesList.insertAdjacentHTML(
                "beforeend",
                `<li><a href="${s.url}" target="_blank" rel="noopener noreferrer" class="text-ocean-blue hover:underline">${title}</a></li>`
              );
            } else {
              sourcesList.insertAdjacentHTML(
                "beforeend",
                `<li>${JSON.stringify(s)}</li>`
              );
            }
          });
        }

        /* ---------- determine which sections actually have content and hide/show (IN PAGE ORDER) ---------- */
        const sections = [
          {
            id: "section-stats",
            label: "Dados principais",
            present: stats.length > 0,
          },
          {
            id: "section-description",
            label: "Descri√ß√£o",
            present: ocean.description && ocean.description.trim() !== "",
          },
          {
            id: "countries",
            label: "Pa√≠ses",
            present: countriesArr.length > 0,
          },
          { id: "rivers", label: "Rios", present: riversArr.length > 0 },
          {
            id: "characteristics",
            label: "Caracter√≠sticas",
            present: charArr.length > 0,
          },
          {
            id: "currents",
            label: "Correntes",
            present: currentsArr.length > 0,
          },
          {
            id: "temperature",
            label: "Temperatura",
            present:
              ocean.temperature &&
              ((Array.isArray(ocean.temperature) &&
                ocean.temperature.length > 0) ||
                (typeof ocean.temperature === "object" &&
                  Object.keys(ocean.temperature).length > 0)),
          },
          {
            id: "elnino",
            label: "El Ni√±o / La Ni√±a",
            present: !!(ocean.elNino || ocean.laNina || ocean.elNinoLaNina),
          },
          {
            id: "animals",
            label: "Animais",
            present:
              endangered.length +
                important.length +
                rare.length +
                popular.length >
              0,
          },
          {
            id: "curiosities",
            label: "Curiosidades",
            present: funFacts.length > 0,
          },
          { id: "history", label: "Hist√≥rico", present: historyArr.length > 0 },
          {
            id: "otherinfo",
            label: "Outras informa√ß√µes",
            present:
              ocean.otherInfo &&
              (typeof ocean.otherInfo === "string"
                ? ocean.otherInfo.trim() !== ""
                : Array.isArray(ocean.otherInfo)
                ? ocean.otherInfo.length > 0
                : true),
          },
          { id: "sources", label: "Fontes", present: sources.length > 0 },
        ];

        const visibleSections = [];
        sections.forEach((s) => {
          const el = document.getElementById(s.id);
          if (!el) return;
          if (s.present) {
            el.classList.remove("hidden");
            visibleSections.push({ id: s.id, label: s.label });
          } else {
            el.classList.add("hidden");
          }
        });

        // build summary nav
        buildSummaryNav(visibleSections);

        // finalize: hide loading, show content
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("ocean-content").classList.remove("hidden");

        // if page loaded with hash, smooth scroll to it
        if (location.hash) {
          const id = location.hash.slice(1);
          const el = document.getElementById(id);
          if (el)
            setTimeout(() => el.scrollIntoView({ behavior: "smooth" }), 300);
        }
      }

      function showError() {
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("error-content").classList.remove("hidden");
      }

      /* ---------- init ---------- */
      document.addEventListener("DOMContentLoaded", () => {
        loadOceanData();

        // floating top button behavior: scroll to summary if exists, otherwise to top
        const toTopBtn = document.getElementById("to-top-btn");
        toTopBtn.addEventListener("click", () => {
          const summary = document.getElementById("section-summary");
          if (summary && !summary.classList.contains("hidden")) {
            summary.scrollIntoView({ behavior: "smooth", block: "center" });
          } else {
            window.scrollTo({ top: 0, behavior: "smooth" });
          }
        });

        // optional: show/hide toTopBtn based on scroll (but requirement said always visible like header,
        // so we keep it visible ‚Äî you can uncomment next lines to hide when at very top)

        window.addEventListener("scroll", () => {
          if (window.scrollY < 100) {
            toTopBtn.style.opacity = "0.9";
          } else {
            toTopBtn.style.opacity = "1";
          }
        });
      });
    </script>
  </body>
</html>
